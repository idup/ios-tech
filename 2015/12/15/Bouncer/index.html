<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="telephone=no" name="format-detection"/><meta name="description"/><title>Bouncer | iOS技术演示</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"/><link rel="stylesheet" type="text/css" href="/css/pure-min.css"/><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"/><link rel="stylesheet" type="text/css" href="/css/style.css"/><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Bouncer</h1><a id="logo" href="/">iOS技术演示</a><p class="description"></p></div><div id="nav-menu"><a href="/" class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/about/"><i class="icon-about"> 关于</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">Bouncer</h1><div class="post-meta">2015-12-15 | </div><div class="post-content"><p>本教程将介绍如何在应用中使用手势和传感器技术。 相应代码位于 ［<a href="https://github.com/idup/Bouncer］(https://github.com/idup/Bouncer)。" target="_blank" rel="external">https://github.com/idup/Bouncer］(https://github.com/idup/Bouncer)。</a></p>
<p><img src="/picture/3-1.png" alt=""></p>
<h3 id="1-新建项目">1.新建项目</h3><p>运行Xcode，选择File-&gt;New-&gt;Project…(键盘快捷键是Command + Shift + N)。在新出现的窗口中，选择左侧iOS部分的Application，然后选择右边的Single View Application（单窗口应用）模板，单击Next按钮。<br>在文本框Product Name中填入Bouncer, 在Language弹出式菜单中选择Swift，在Devices弹出式菜单中选择iPhone。确保标题为Use Core Data的选择框未被选中，点击下一步按钮,单击创建按钮创建项目。</p>
<p><img src="/picture/3-2.png" alt=""></p>
<h3 id="2-Core_Motion">2.Core Motion</h3><p>Core Motion对CMMotionManager,CMAccelerometerData,CMDeviceMotion, CMGyroData进行了很好的封装,可以让开发者进行方便的管理。<br>￼<br>CMMotionManager可以访问所有从iOS设备上获取的Core Motion数据。主要方式 分为pull和push两种,pull需要手动向manager索要数据,即最近一次的采样数据, 而push方式则是自动在每一个采样数据到来的时候执行闭包里面的函数进行处理。</p>
<p><img src="/picture/3-3.png" alt=""></p>
<h4 id="2-1加速计原理">2.1加速计原理</h4><p>iPhone的加速度计有三个轴,分别是x轴、y轴、z轴,如上图所示。这是一个三 维立体空间,可以捕获用户每一个角度的操作。通过这三个轴可以计算iPhone倾斜的 角度,从而计算出加速度。</p>
<p>(1)对于iphone手机来说,画面上下为y轴,左右为z轴,贯穿屏幕为z轴。</p>
<p>(2)向上,向右,手机的前面分别是各轴的正方向。</p>
<h4 id="2-2加速计使用步骤">2.2加速计使用步骤</h4><p>(1)实例化CMMotionManager类</p>
<p>(2)向CMMotionManager的accelerometerUpdateInterval属性中设置通知间隔 时间值。</p>
<p>(3)使用NSOperationQueue.currentQueue()建立一个监听队列。</p>
<p>(4)使用startAccelerometerUpdatesToQueue方法更新监听队列,并设置回调 函数用于接受加速度通知。在回调函数中使用accelerometerData.acceleration相关 属性可以获取x、y、z各个方向的加速度。</p>
<h4 id="2-3频率设置建议">2.3频率设置建议</h4><p>accelerometerUpdateInterval表示通知频率,表示间隔多少秒通知一次。 iPhone开发文档中推荐使用的通知间隔如下:</p>
<p>(1)检测设备朝向:1/10 ~ 1/20</p>
<p>(2)在游戏中需要实时使用加速传感器时:1/30 ~ 1/60</p>
<p>(3)检测敲击设备或者剧烈摇动设备的情况下:1/70 ~ 1/100</p>
<h3 id="3-code">3.code</h3><p>相关代码请参考Demo</p>
<h4 id="3-1AppDelegate-swift">3.1AppDelegate.swift</h4><p>打开AppDelegate.swift代码窗口,删除class内代码,由于APP中所有用 CoreMotion的对象都需要使用同一个实例,所以需要在AppDelegate中新建Manager, 代码如下。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Motion</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">let</span> <span class="type">Manager</span> = <span class="type">CMMotionManager</span>()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>当然,首先应该导入CoreMotion库。</p>
<figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"><span class="keyword">import</span> CoreMotion</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2BouncerBehavior-">3.2BouncerBehavior.</h4><p>在BouncerBehavior.swift中,我们封装了Bouncer需要用到的 UIDynamicBehavior。我们定义了gravity,collider,blockBehavior三个成员变 量,并对后两者进行了lazy init。</p>
<p>之所以使用lazy init,原因有二:</p>
<p>一来构造collider的时候有的东西不能使用,二来构造的时候需要设置属性。</p>
<p> blockBehavior可以改变动力元素的一些属性,如修改allowsRotation属性可以<br>设置元素是否可以旋转,修改elasticity属性决定碰撞是否为弹性碰撞,能量损耗是 多少等等。具体可以参见apple官网的开发者指南。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> gravity = <span class="type">UIGravityBehavior</span>()</span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> collider: <span class="type">UICollisionBehavior</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> lazilyCreatedCollider =</span><br><span class="line"><span class="type">UICollisionBehavior</span>()</span><br><span class="line">lazilyCreatedCollider.translatesReferenceBoundsIntoB</span><br><span class="line">oundary = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">return</span> lazilyCreatedCollider</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> blockBehavior: <span class="type">UIDynamicItemBehavior</span> =</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">let</span> lazilyCreatedBlockBehavior =</span><br><span class="line"><span class="type">UIDynamicItemBehavior</span>()</span><br><span class="line">        lazilyCreatedBlockBehavior.allowsRotation =</span><br><span class="line">        lazilyCreatedBlockBehavior.elasticity = <span class="number">0.85</span></span><br><span class="line">        lazilyCreatedBlockBehavior.friction = <span class="number">0</span></span><br><span class="line">        lazilyCreatedBlockBehavior.resistance = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> lazilyCreatedBlockBehavior</span><br><span class="line">&#125;()</span><br><span class="line">在重写的<span class="keyword">init</span>方法中,我们将gravity,collider,blockBehavior加入到当前 行为规则中。同时又添加了addBlock和removeBlock两个封装好的方法,用来添加和 移除遵循行为的对象。</span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="keyword">override</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">        addChildBehavior(gravity)</span><br><span class="line">        addChildBehavior(collider)</span><br><span class="line">        addChildBehavior(blockBehavior)</span><br><span class="line">    &#125;</span><br><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">addBlock</span><span class="params">(block: UIView)</span></span> &#123;</span><br><span class="line">dynamicAnimator?.referenceView?.addSubview(block)</span><br><span class="line">        gravity.addItem(block)</span><br><span class="line">        collider.addItem(block)</span><br><span class="line">        blockBehavior.addItem(block)</span><br><span class="line">    &#125;</span><br><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">removeBlock</span><span class="params">(block: UIView)</span></span> &#123;</span><br><span class="line">        gravity.removeItem(block)</span><br><span class="line">        collider.removeItem(block)</span><br><span class="line">        blockBehavior.removeItem(block)</span><br><span class="line">        block.removeFromSuperview()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-3ViewController-swift">3.3ViewController.swift</h4><p>在ViewController.swift中我们做如下三件事:<br>首先,建立建立Animation Behavior,并且绑定当前view为UIDynamicAnimator的referenceView。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> bouncer = <span class="type">BouncerBehavior</span>()</span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> animator: <span class="type">UIDynamicAnimator</span> =</span><br><span class="line">&#123; <span class="type">UIDynamicAnimator</span>(referenceView: <span class="keyword">self</span>.view) &#125;()</span><br></pre></td></tr></table></figure>
<p>其次,在View Controller的生命周期中控制数据采集的开始和结束,并向其中添加对象。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        animator.addBehavior(bouncer)</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">viewDidAppear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidAppear(animated)</span><br><span class="line">        <span class="keyword">if</span> redBlock == <span class="literal">nil</span> &#123;</span><br><span class="line">            redBlock = addBlock()</span><br><span class="line">            redBlock?.backgroundColor =</span><br><span class="line"><span class="type">UIColor</span>.redColor()</span><br><span class="line">            bouncer.addBlock(redBlock!)</span><br><span class="line">&#125;</span><br><span class="line">        <span class="keyword">let</span> motionManager =</span><br><span class="line"><span class="type">AppDelegate</span>.<span class="type">Motion</span>.<span class="type">Manager</span></span><br><span class="line">        <span class="keyword">if</span> motionManager.accelerometerAvailable</span><br><span class="line">&#123; motionManager.startAccelerometerUpdatesToQueue(<span class="type">NSO</span></span><br><span class="line">perationQueue.mainQueue()) &#123; (data, error) -&gt; <span class="type">Void</span></span><br><span class="line"><span class="keyword">in</span></span><br><span class="line"><span class="keyword">self</span>.bouncer.gravity.gravityDirection = <span class="type">CGVector</span>(dx:</span><br><span class="line">data!.acceleration.x, dy: -data!.acceleration.y)</span><br><span class="line">&#125; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">viewWillDisappear</span><span class="params">(animated: Bool)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewWillDisappear(animated)</span><br><span class="line"><span class="type">AppDelegate</span>.<span class="type">Motion</span>.<span class="type">Manager</span>.stopAccelerometerUpdates(</span><br><span class="line">)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后,还要封装addBlock方法,添加视图。</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">var</span> redBlock: UIView?</span><br><span class="line">    func <span class="keyword">addBlock() </span>-&gt; UIView &#123;</span><br><span class="line">        let <span class="keyword">block </span>= UIView(frame: CGRect(origin:</span><br><span class="line"><span class="label">CGPoint.zero</span>, size: Constants.<span class="keyword">BlockSize))</span><br><span class="line"></span>        <span class="keyword">block.center </span>= CGPoint(x: view.<span class="keyword">bounds.midX,</span><br><span class="line"></span>y: view.<span class="keyword">bounds.midY)</span><br><span class="line"></span>        view.<span class="keyword">addSubview(block)</span><br><span class="line"></span>        return <span class="keyword">block</span><br><span class="line"></span>    &#125;</span><br><span class="line"><span class="keyword">struct </span>Constants &#123;</span><br><span class="line">        static let <span class="keyword">BlockSize </span>= CGSize(width: <span class="number">40</span>,</span><br><span class="line"><span class="label">height</span>: <span class="number">40</span>) &#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-运行项目">4.运行项目</h3><p>由于Xcode7之后支持直接进行真机调试而不需 要开发者账号,因此我们将设备与Mac连接后, 在模拟器列表中选择我们的设备,然后点击运 行即可(快捷键 Command + R)。</p>
<p><img src="p/icture/3-4.png" alt=""></p>
</div><div class="tags"></div><div class="post-nav"><a href="/2015/12/15/Dropit/" class="pre"><i class="icon-previous">Dropit</i></a><a href="/2015/12/15/Cassini/" class="next">Cassini<i class="icon-next"></i></a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div id="search"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://ios-tech.idup.club"></form></div></div><div class="widget"><div class="widget-title">分类</div></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2015/12/16/Location/">Location</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/16/Camera/">Camera</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/15/Dropit/">Dropit</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/15/Bouncer/">Bouncer</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/15/Cassini/">Cassini</a></li></ul></div><div class="widget"><div class="widget-title">友情链接</div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><div id="footer">© <a href="/" rel="nofollow">iOS技术演示.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"></div></body></html>